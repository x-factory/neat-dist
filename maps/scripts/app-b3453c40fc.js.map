{"version":3,"sources":["scripts/app-b3453c40fc.js"],"names":["angular","module","UsersController","UserData","$log","$document","AuthService","UserDialog","activate","getSearchField","searchField","doc","getElementById","element","ready","vm","showEnabled","getUsers","then","successUsers","assignUsers","users","data","type","info","getDisabledUsers","disabledUsers","switchUsers","addOrDeleteAll","ev","showAdd","showConfirm","name","changeRole","user","privilege","updateRole","id","focusSearch","focus","roleClass","resetText","disabled","active","this","isAdmin","isSelf","$inject","controller","$mdDialog","$mdToast","idx","confirmTitle","dialog","text","del","content","ariaLabel","ok","confirmAction","deleteUser","splice","confirmToast","message","delAll","deleteAllDisabled","length","affected","reset","resetUser","enable","enableUser","confirm","title","textContent","targetEvent","cancel","show","simple","position","hideDelay","AddDialogController","$scope","add","createUser","email","push","hide","templateUrl","parent","body","clickOutsideToClose","service","factory","url","$q","$http","get","getUsersComplete","catchErrorFn","actionComplete","errMsg","e","newMessage","description","error","reject","post","put","password","actionErrMsg","MapInit","$window","ApiKey","asyncLoad","asyncUrl","cbName","log","script","createElement","src","appendChild","geocoder","Gmap","latLng","onceLocated","geocodeCb","results","status","GeocoderStatus","OK","alert","gc","Geocoder","geocode","location","document","mapsDefer","defer","GMapInitialized","resolve","initialized","promise","MapDialog","byId","MapData","mapIcons","$rootScope","$timeout","createInfoContent","record","address","Location","severity","divider","editBtn","delBtn","initMarkerDialog","types","neatMap","magicMarker","marker","infowindow","markers","DialogController","addPlaceSearch","input","searchBox","places","SearchBox","addListener","setBounds","getBounds","getPlaces","place","geometry","lng","lat","recordVals","long","user_id","me","type_id","typeId","isUpdate","isMapAdd","update","createRecord","close","confirmDelete","newRecord","latitude","longitude","updateRecord","myRecord","setIcon","TypeId","setPosition","locateCurrent","locating","nav","geolocation","getCurrentPosition","pos","autoFillAddress","result","formatted_address","$apply","coords","performDelete","deleteRecord","deleteUIcleanUp","setMap","indexOf","navigator","getTypes","getDataComplete","getRecords","getFilteredRecords","chosenTypes","queryStr","join","MapController","$mdSidenav","mapEl","setupMap","setupControls","google","maps","Map","center","zoom","clickMapToAddListener","assignRecordsToMarkers","onClickAddMarker","addPlaceholder","resetTime","geo","setTimeout","records","forEach","local","animate","tbd","options","icon","map","animation","Animation","DROP","Marker","attachMarkerEvent","clearMarkers","self","InfoWindow","addEventListener","showDialog","open","typeArrayToMap","prev","curr","typeArrayToFilterModel","checked","reduce","filterTypes","$watch","now","clearing","applySeverity","toggleSideMenu","toggle","filterUpdate","toTypeIdArray","fSeverity","filterSeverity","filterClearAll","clearAllTypes","AuthController","$state","login","getMe","go","joinNeat","register","res","enter","charCode","NavController","logout","AuthToken","getToken","localStorage","getItem","setToken","token","setItem","removeItem","registrationComplete","registrationFailed","authSuccess","authFailed","isLoggedIn","Boolean","getMeComplete","getMeFailed","AuthInterceptor","request","config","headers","Authorization","responseError","runBlock","watchAuth","toState","preventDefault","$on","debug","run","routerConfig","$stateProvider","$locationProvider","$urlRouterProvider","navView","controllerAs","state","views","otherwise","html5Mode","level","toLowerCase","levels",1,2,3,4,5,"replace","anchor","Point","path","baseUrl","constant","$logProvider","$httpProvider","$mdThemingProvider","$mdIconProvider","debugEnabled","interceptors","neatGrey","extendPalette","900","neatRed","400","definePalette","theme","primaryPalette","default","accentPalette","hue-2","warnPalette","$templateCache"],"mappings":"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","file":"scripts/app-b3453c40fc.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('neatClient', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ui.router',\n      'ngMaterial'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .controller('UsersController', UsersController);\n\n  /** @ngInject */\n  function UsersController(\n    UserData,\n    $log,\n    $document,\n    AuthService,\n    UserDialog\n  ) {\n    var vm = this;\n    var doc = $document[0];\n    var users;\n    var disabledUsers;\n    var searchField;\n    var showAdd = UserDialog.showAdd;\n\n    vm.isAdmin = AuthService.isAdmin;\n    vm.isSelf = AuthService.isSelf;\n    vm.switchUsers = switchUsers;\n    vm.showConfirm = UserDialog.showConfirm;\n    vm.addOrDeleteAll = addOrDeleteAll;\n    vm.changeRole = changeRole;\n    vm.focusSearch = focusSearch;\n    vm.roleClass = roleClass;\n    vm.resetText = resetText;\n\n    activate();\n\n    function activate() {\n      angular.element(doc).ready(getSearchField);\n      vm.showEnabled = true;\n      return getUsers().then(successUsers);\n      function getSearchField() {\n        searchField = doc.getElementById('user-search');\n      }\n    }\n\n    /////////////////////////////////\n    // GET users\n    // /////////////////////////////\n    function getUsers() {\n      return UserData.getUsers()\n        .then(assignUsers(users));\n    }\n\n    function assignUsers(users) {\n      return function(data) {\n        users = data;\n        vm.users = users;\n        return vm.users;\n      };\n    }\n\n    function successUsers() {\n      var type = vm.showEnabled ? ' ' : ' disabled ';\n      $log.info('Loaded' + type + 'users');\n    }\n\n    function getDisabledUsers() {\n      return UserData.getDisabledUsers()\n        .then(assignUsers(disabledUsers));\n    }\n\n    /////////////////////////////////\n    // ngClick functions\n    // /////////////////////////////\n    function switchUsers() {\n      vm.showEnabled = !vm.showEnabled;\n      return vm.showEnabled\n        ? getUsers().then(successUsers)\n        : getDisabledUsers().then(successUsers);\n    }\n\n    function addOrDeleteAll(ev) {\n      if (vm.showEnabled) {\n        showAdd(ev, vm.users);\n      } else {\n        vm.showConfirm(ev, 0, 'delAll', { name: '' }, vm.users);\n      }\n    }\n\n    function changeRole(user) {\n      var privilege = user.privilege == 'A' ? 'M' : 'A';\n      UserData.updateRole(user.id, privilege)\n        .then(function() {\n          user.privilege = privilege;\n        });\n    }\n\n    /////////////////////////////////\n    // DOM manipulation\n    // /////////////////////////////\n    function focusSearch() {\n      searchField.focus();\n    }\n\n    /////////////////////////////////\n    // Classes and Texts\n    // /////////////////////////////\n    function roleClass(privilege) {\n      return privilege == 'A'\n        ? 'md-warn'\n        : 'md-accent md-hue-3';\n    }\n\n    function resetText(user) {\n      if (user.disabled) return 'enable';\n      if (user.active) return 'reset';\n      return 'inactive';\n    }\n\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('UserDialog', UserDialog);\n\n  /** @ngInject */\n  function UserDialog(\n    $mdDialog,\n    UserData,\n    $document,\n    $mdToast\n  ) {\n    var doc = $document[0];\n\n    var service = {\n      showConfirm: showConfirm,\n      showAdd: showAdd\n    };\n\n    return service;\n\n    function showConfirm(ev, idx, type, user, users) {\n      var dialog = {\n        del: {\n          text: ' delete ',\n          content: 'If the user has associated records, user will be disabled instead. Switch to disabled users view to perform hard delete.',\n          ariaLabel: 'Confirm delete',\n          ok: 'Delete',\n          confirmAction: function confirmDelete() {\n            UserData.deleteUser(user.id).then(function(data) {\n              users.splice(idx, 1);\n              confirmToast(data.message + ': ' + user.name);\n            });\n          }\n        },\n        delAll: {\n          text: ' DELETE ALL ',\n          content: 'Delete all disabled users. Are you sure?',\n          ariaLabel: 'Confirm delete all',\n          ok: 'Delete All',\n          confirmAction: function confirmDelAll() {\n            UserData.deleteAllDisabled().then(function(data) {\n              users.length = 0;\n              confirmToast(data.message + ': ' + data.affected);\n            });\n          }\n        },\n        reset: {\n          text: ' reset ',\n          content: 'Deactivate user and reset password. Once reset, user need to go through sign up process same as new user',\n          ariaLabel: 'Confirm reset',\n          ok: 'Reset',\n          confirmAction: function confirmReset() {\n            UserData.resetUser(user.id).then(function() {\n              user.active = false;\n              confirmToast('Reset ' + user.name);\n            });\n          }\n        },\n        enable: {\n          text: ' enable ',\n          content: 'Will restore user to original state (active or inactive)',\n          ariaLabel: 'Confirm enable',\n          ok: 'Enable',\n          confirmAction: function confirmEnable() {\n            UserData.enableUser(user.id).then(function() {\n              users.splice(idx, 1);\n              confirmToast('Enabled ' + user.name);\n            });\n          }\n        }\n      };\n\n      function confirmTitle() {\n        return 'Confirm to' + dialog[type].text + user.name;\n      }\n\n      var confirm = $mdDialog.confirm()\n        .title(confirmTitle())\n        .textContent(dialog[type].content)\n        .ariaLabel(dialog[type].ariaLabel)\n        .targetEvent(ev)\n        .ok(dialog[type].ok)\n        .cancel('Cancel');\n\n      $mdDialog\n        .show(confirm)\n        .then(dialog[type].confirmAction);\n    } // showConfirm\n\n    function confirmToast(message) {\n      return $mdToast.show(\n        $mdToast.simple()\n        .textContent(message)\n        .position('bottom right')\n        .hideDelay(2000)\n      );\n    }\n\n    function showAdd(ev, users) {\n      $mdDialog.show({\n        controller: AddDialogController,\n        templateUrl: 'app/users/add.dialog.html',\n        parent: angular.element(doc.body),\n        targetEvent: ev,\n        clickOutsideToClose: true\n      });\n\n      function AddDialogController($scope, $mdDialog) {\n        $scope.privilege = 'M';\n\n        $scope.cancel = function() {\n          $mdDialog.cancel();\n        };\n\n        $scope.add = function() {\n          UserData.createUser({\n            email: $scope.email,\n            name: $scope.name,\n            privilege: $scope.privilege\n          }).then(function(data) {\n            var user = data.user;\n            users.push(user);\n            confirmToast('Added user: ' + user.name);\n            $mdDialog.hide();\n          });\n        };\n      }\n    } // showAdd\n\n  } // UserDialog Service\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('UserData', UserData);\n\n  /** @ngInject */\n  function UserData(\n    url,\n    $q,\n    $log,\n    $http\n  ) {\n\n    var service = {\n      getUsers: getUsers,\n      getDisabledUsers: getDisabledUsers,\n      createUser: createUser,\n      resetUser: resetUser,\n      updateRole: updateRole,\n      enableUser: enableUser,\n      deleteUser: deleteUser,\n      deleteAllDisabled: deleteAllDisabled\n    };\n\n    return service;\n\n    /////////////////////////////////\n    // GET\n    // /////////////////////////////\n    function getUsers() {\n      return $http.get(url('/users'))\n        .then(getUsersComplete)\n        .catch(catchErrorFn('XHR getUsers failed'));\n    }\n\n    function getDisabledUsers() {\n      return $http.get(url('/users?disabled=1'))\n        .then(getUsersComplete)\n        .catch(catchErrorFn('XHR getDisabledUsers failed'));\n    }\n\n    /////////////////////////////////\n    // Promise Fulfilled / Rejected\n    // /////////////////////////////\n    function getUsersComplete(data) {\n      var users = data.data.users;\n      return users;\n    }\n\n    function actionComplete(data) {\n      return data.data;\n    }\n\n    function catchErrorFn(errMsg) {\n\n      return function requestFailed(e) {\n        var newMessage = errMsg;\n        if (e.data && e.data.description) {\n          newMessage += '\\n' + e.data.description;\n        }\n        if (e.data) {\n          e.data.description = newMessage;\n        }\n        $log.error(e.data);\n        return $q.reject(e);\n      };\n    }\n\n    /////////////////////////////////\n    // POST\n    // /////////////////////////////\n    function createUser(user) {\n      return $http.post(url('/users'), user)\n        .then(actionComplete)\n        .catch(catchErrorFn('XHR createUser failed'));\n    }\n\n    /////////////////////////////////\n    // PUT\n    // /////////////////////////////\n    function resetUser(id) {\n      return $http.put(url('/user', id), {\n        password: 'null',\n        active: 'No'\n      }).then(actionComplete)\n        .catch(catchErrorFn(actionErrMsg('resetUser', id)));\n    }\n\n    function updateRole(id, privilege) {\n      return $http.put(url('/user', id), {\n        privilege: privilege\n      }).then(actionComplete)\n        .catch(catchErrorFn(actionErrMsg('updateRole', id)));\n    }\n\n    function enableUser(id) {\n      return $http.put(url('/user', id), {\n        disabled: 'false'\n      }).then(actionComplete)\n        .catch(catchErrorFn(actionErrMsg('enableUser', id)));\n    }\n\n    /////////////////////////////////\n    // DELETE\n    // /////////////////////////////\n    function deleteUser(id) {\n      return $http.delete(url('/user', id))\n        .then(actionComplete)\n        .catch(catchErrorFn(actionErrMsg('deleteUser', id)));\n    }\n\n    function deleteAllDisabled() {\n      return $http.delete(url('/users'))\n        .then(actionComplete)\n        .catch(catchErrorFn('XHR deleteAllDisabled failed'));\n    }\n\n    /////////////////////////////////\n    // Helpers\n    // /////////////////////////////\n    function actionErrMsg(name, id) {\n      return 'XHR ' + name + ' by ' + id + ' failed';\n    }\n\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('MapInit', MapInit);\n\n  /** @ngInject */\n  function MapInit(\n    $window,\n    ApiKey,\n    $log,\n    $q\n  ) {\n    var doc = $window.document;\n    var asyncUrl = 'https://maps.googleapis.com/maps/api/js?key=';\n    asyncUrl += ApiKey + '&libraries=places&callback=';\n    var mapsDefer = $q.defer();\n\n    $window.GMapInitialized = mapsDefer.resolve;\n\n    function asyncLoad(asyncUrl, cbName) {\n      $log.log('adding script tag');\n      var script = doc.createElement('script');\n      script.src = asyncUrl + cbName;\n      doc.body.appendChild(script);\n    }\n    asyncLoad(asyncUrl, 'GMapInitialized');\n\n    var service = {\n      initialized: mapsDefer.promise,\n      geocoder: geocoder\n    };\n\n    function geocoder(Gmap, latLng, onceLocated) {\n      var gc = new Gmap.Geocoder;\n      gc.geocode({ location: latLng }, geocodeCb);\n\n      function geocodeCb(results, status) {\n        if (status === Gmap.GeocoderStatus.OK) {\n          if (results[0]) {\n            onceLocated(results[0]);\n          } else {\n            $window.alert('No results found');\n          }\n        } else {\n          $window.alert('Geocoder failed due to: ' + status);\n        }\n      }\n    }\n\n    return service;\n\n  } // MapInit\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('MapDialog', MapDialog);\n\n  /** @ngInject */\n  function MapDialog(\n    byId,\n    MapData,\n    MapInit,\n    mapIcons,\n    $document,\n    $log,\n    $mdDialog,\n    $mdToast,\n    $rootScope,\n    $timeout,\n    $window\n  ) {\n    var nav = $window.navigator;\n\n    var service = {\n      createInfoContent: createInfoContent,\n      initMarkerDialog: initMarkerDialog,\n      confirmDelete: confirmDelete\n    };\n\n    return service;\n\n    function createInfoContent(record) {\n      var address = '<h4>' + record.Location.address + '</h4>';\n      var severity = '<p>Severity: ' + record.severity + '</p>';\n      var description = '<p>' + (record.description || 'n/a') + '</p>';\n      var divider = '<md-divider></md-divider>';\n      var editBtn = '<button class=\"md-primary md-button\" type=\"button\"' +\n        ' aria-label=\"Edit\" id=\"edit-record-btn\">Edit</button>';\n      var delBtn = '<button class=\"md-primary md-button\" type=\"button\"' +\n        ' aria-label=\"Delete\" id=\"del-record-btn\">Delete</button>';\n      var content = address + severity + description +\n                    divider + editBtn + delBtn;\n      return content;\n    }\n\n    function initMarkerDialog(\n      types,\n      Gmap,\n      neatMap,\n      magicMarker\n    ) {\n\n      return function showDialog(ev, marker, infowindow, markers) {\n        $mdDialog.show({\n          controller: DialogController,\n          templateUrl: 'app/map/marker.dialog.html',\n          parent: angular.element($document[0].body),\n          targetEvent: ev,\n          clickOutsideToClose: true\n        });\n\n        function DialogController($scope, $mdDialog) {\n          var vm = $scope;\n          var record;\n          var isUpdate = marker ? true : false;\n          var isMapAdd;\n          $timeout(addPlaceSearch);\n\n          vm.types = types;\n          vm.severity = 3;\n          vm.cancel = cancel;\n          vm.confirm = confirm;\n          vm.locateCurrent = locateCurrent;\n\n          if (isUpdate) {\n            record = marker.myRecord;\n            vm.lat = record.Location.latitude;\n            vm.long = record.Location.longitude;\n            vm.address = record.Location.address;\n            vm.description = record.description;\n            vm.severity = record.severity;\n            vm.typeId = record.TypeId;\n            // for adding directly on the map without clicking add button\n            isMapAdd = !record.TypeId;\n          }\n\n          function addPlaceSearch() {\n            var input = byId('address');\n            var searchBox = new Gmap.places.SearchBox(input);\n\n            neatMap.addListener('bounds_changed', function() {\n              searchBox.setBounds(neatMap.getBounds());\n            });\n\n            searchBox.addListener('places_changed', function() {\n              var places = searchBox.getPlaces();\n              if (places.length === 0) return;\n              var place = places[0];\n              vm.address = place.name;\n              vm.long = place.geometry.location.lng();\n              vm.lat = place.geometry.location.lat();\n            });\n          }\n\n          function cancel() {\n            $mdDialog.cancel();\n          }\n\n          function confirm() {\n            var recordVals = {\n              long: vm.long,\n              lat: vm.lat,\n              address: vm.address,\n              description: vm.description,\n              severity: vm.severity,\n              user_id: $rootScope.me.id,\n              type_id: vm.typeId\n            };\n\n            if (isUpdate && !isMapAdd) {\n              update(recordVals);\n            } else {\n              add(recordVals);\n            }\n            $mdDialog.hide();\n          }\n\n          function add(recordVals) {\n            MapData.createRecord(recordVals)\n              .then(function(data) {\n                if (isMapAdd) {\n                  infowindow.close();\n                  confirmDelete(ev, marker, markers);\n                }\n                var newRecord = data.record;\n                newRecord.Location = {\n                  address: vm.address,\n                  latitude: vm.lat,\n                  longitude: vm.long\n                };\n                magicMarker(vm.lat, vm.long, newRecord, true);\n              });\n          }\n\n          function update(recordVals) {\n            MapData.updateRecord(record.id, recordVals)\n              .then(function(data) {\n                // closes infowindow\n                infowindow.close();\n                var newRecord = data.affected[1][0];\n                newRecord.Location = {\n                  address: vm.address,\n                  latitude: vm.lat,\n                  longitude: vm.long\n                };\n                marker.myRecord = newRecord;\n                marker.setIcon(mapIcons(\n                  types[newRecord.TypeId],\n                  newRecord.severity,\n                  Gmap\n                ));\n                marker.setPosition({\n                  lat: vm.lat,\n                  lng: vm.long\n                });\n              });\n          }\n\n          function locateCurrent() {\n            vm.address = 'Locating...';\n            vm.locating = true;\n            if (nav.geolocation) {\n              nav.geolocation.getCurrentPosition(function(pos) {\n                vm.lat = pos.coords.latitude;\n                vm.long = pos.coords.longitude;\n                MapInit.geocoder(Gmap, {\n                  lat: vm.lat, lng: vm.long\n                }, autoFillAddress);\n                function autoFillAddress(result) {\n                  vm.locating = false;\n                  vm.address = result.formatted_address;\n                  vm.$apply();\n                }\n              });\n            } else {\n              $log.error('Browser does not support goelocation');\n            }\n          }\n\n        } // dialogCtrl\n      }; // showDialog\n\n    } // initMarkerDialog\n\n    function confirmDelete(ev, marker, markers) {\n      var record = marker.myRecord;\n      if (!record.TypeId) {\n        return deleteUIcleanUp();\n      }\n\n      var address = record.Location.address;\n      var text =\n        'Inreversible. Are you sure you want to delete: ' + address + '?';\n      var confirm = $mdDialog.confirm()\n        .title('Confirm to delete')\n        .textContent(text)\n        .ariaLabel('Confirm delete')\n        .targetEvent(ev)\n        .ok('Delete')\n        .cancel('Cancel');\n\n      $mdDialog\n        .show(confirm)\n        .then(performDelete);\n\n      function performDelete() {\n        MapData.deleteRecord(marker.myRecord.id)\n          .then(deleteUIcleanUp);\n      }\n\n      function deleteUIcleanUp(data) {\n        marker.setMap(null);\n        var idx = markers.indexOf(marker);\n        if (idx > -1) {\n          markers.splice(idx, 1);\n        }\n        if (data) {\n          $log.info(data);\n        }\n      }\n    } // confirmDelete\n\n\n  } // MapDialog Service\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('MapData', MapData);\n\n  /** @ngInject */\n  function MapData(\n    url,\n    $q,\n    $log,\n    $http\n  ) {\n\n    var service = {\n      getTypes: getTypes,\n      getRecords: getRecords,\n      getFilteredRecords: getFilteredRecords,\n      createRecord: createRecord,\n      updateRecord: updateRecord,\n      deleteRecord: deleteRecord\n    };\n\n    return service;\n\n    /////////////////////////////////\n    // GET\n    // /////////////////////////////\n    function getTypes() {\n      return $http.get(url('/types'))\n        .then(getDataComplete('types'))\n        .catch(catchErrorFn('XHR getTypes failed'));\n    }\n\n    function getRecords() {\n      return $http.get(url('/records'))\n        .then(getDataComplete('records'))\n        .catch(catchErrorFn('XHR getRecords failed'));\n    }\n\n    function getFilteredRecords(chosenTypes, severity) {\n      var queryStr = '?';\n\n      if (chosenTypes.length > 0) {\n        chosenTypes = chosenTypes.join();\n        queryStr += 'ftypes=' + chosenTypes;\n        queryStr += severity > 0 ? '&' : '';\n      }\n\n      if (severity > 0) {\n        queryStr += 'fseverity=' + severity;\n      }\n\n      return $http.get(url('/records' + queryStr))\n        .then(getDataComplete('records'))\n        .catch(catchErrorFn('XHR getFilteredRecords failed'));\n    }\n\n    /////////////////////////////////\n    // Promise Fulfilled / Rejected\n    // /////////////////////////////\n    function getDataComplete(type) {\n      return function complete(data) {\n        return data.data[type];\n      };\n    }\n\n    function actionComplete(data) {\n      return data.data;\n    }\n\n    function catchErrorFn(errMsg) {\n\n      return function requestFailed(e) {\n        var newMessage = errMsg;\n        if (e.data && e.data.description) {\n          newMessage += '\\n' + e.data.description;\n        }\n        if (e.data) {\n          e.data.description = newMessage;\n        }\n        $log.error(e.data);\n        return $q.reject(e);\n      };\n    }\n\n    /////////////////////////////////\n    // POST\n    // /////////////////////////////\n    function createRecord(record) {\n      return $http.post(url('/records'), record)\n        .then(actionComplete)\n        .catch(catchErrorFn('XHR createRecord failed'));\n    }\n\n    /////////////////////////////////\n    // PUT\n    // /////////////////////////////\n    function updateRecord(id, record) {\n      return $http.put(url('/record', id), record)\n        .then(actionComplete)\n        .catch(catchErrorFn(actionErrMsg('updateRecord', id)));\n    }\n\n    /////////////////////////////////\n    // DELETE\n    // /////////////////////////////\n    function deleteRecord(id) {\n      return $http.delete(url('/record', id))\n        .then(actionComplete)\n        .catch(catchErrorFn(actionErrMsg('deleteRecord', id)));\n    }\n\n    /////////////////////////////////\n    // Helpers\n    // /////////////////////////////\n    function actionErrMsg(name, id) {\n      return 'XHR ' + name + ' by ' + id + ' failed';\n    }\n\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .controller('MapController', MapController);\n\n  /** @ngInject */\n  function MapController(\n    byId,\n    MapData,\n    MapDialog,\n    mapIcons,\n    MapInit,\n    $mdDialog,\n    $mdSidenav,\n    $scope,\n    $window\n  ) {\n    var vm = this;\n    var markers = [];\n    var Gmap;\n    var neatMap;\n    var mapEl;\n    var clearing = false; // for filterSeverity watch\n\n    vm.toggleSideMenu = toggleSideMenu;\n    vm.filterUpdate = filterUpdate;\n    vm.filterClearAll = filterClearAll;\n\n    activate();\n\n    function activate() {\n      mapEl = byId('map');\n      MapInit.initialized\n      .then(setupMap)\n      .then(setupControls);\n    }\n\n    /////////////////////////////////\n    // Google Map Setup\n    // /////////////////////////////\n    function setupMap() {\n      Gmap = $window.google.maps;\n      neatMap = new Gmap.Map(mapEl, {\n        center: {lat: 44.4120908, lng: -79.6701331},\n        zoom: 15\n      });\n\n      clickMapToAddListener();\n\n      return getTypes()\n        .then(getRecords)\n        .then(assignRecordsToMarkers);\n    }\n\n    function clickMapToAddListener() {\n      neatMap.addListener('click', onClickAddMarker);\n\n      function onClickAddMarker(ev) {\n        MapInit.geocoder(Gmap, ev.latLng, addPlaceholder);\n      }\n    } // clickMapToAddListener\n\n    /*\n     * Map helpers\n     */\n    function addPlaceholder(result) {\n      var resetTime = 180000; // 3 min\n      var geo = result.geometry.location;\n      var lat = geo.lat();\n      var lng = geo.lng();\n      var record = {\n        Location: {\n          address: result.formatted_address,\n          latitude: lat,\n          longitude: lng\n        },\n        severity: 3\n      };\n      var marker = magicMarker(lat, lng, record, true, true);\n      setTimeout(function clearMarkerIfTooLong() {\n        MapDialog.confirmDelete(0, marker, markers);\n      }, resetTime);\n    }\n\n    function assignRecordsToMarkers(records) {\n      records.forEach(function(record) {\n        var local  = record.Location;\n        magicMarker(local.latitude, local.longitude, record);\n      });\n      return records;\n    }\n\n    function magicMarker(lat, lng, record, animate, tbd) {\n      var type = tbd ? 'placeholder' : vm.types[record.TypeId];\n      var options = {\n        position: { lat: lat, lng: lng },\n        icon: mapIcons(type, record.severity, Gmap),\n        map: neatMap,\n        myRecord: record\n      };\n\n      if (animate) {\n        options.animation = Gmap.Animation.DROP;\n      }\n\n      var marker = new Gmap.Marker(options);\n      attachMarkerEvent(marker);\n      markers.push(marker);\n\n      return marker;\n    }\n\n    function clearMarkers() {\n      markers.forEach(function loopMarkers(marker) {\n        marker.setMap(null);\n      });\n\n      markers = [];\n    }\n\n    function attachMarkerEvent(marker) {\n      marker.addListener('click', function() {\n        var self = this;\n\n        // on click create a new info window with record content\n        var infowindow = new Gmap.InfoWindow({\n          content: MapDialog.createInfoContent(self.myRecord)\n        });\n\n        // add click listener to info window buttons\n        infowindow.addListener('domready', function() {\n          var editBtn = byId('edit-record-btn');\n          var delBtn = byId('del-record-btn');\n\n          editBtn.addEventListener('click', function(ev) {\n            vm.showDialog(ev, self, infowindow, markers);\n          });\n\n          delBtn.addEventListener('click', function(ev) {\n            MapDialog.confirmDelete(ev, self, markers);\n          });\n        });\n\n        infowindow.open(neatMap, self);\n      });\n    }\n\n    /////////////////////////////////\n    // GET\n    // /////////////////////////////\n    function getTypes() {\n      return MapData.getTypes()\n      .then(function(data) {\n        vm.types = data.reduce(typeArrayToMap, {});\n        vm.filterTypes = data.map(typeArrayToFilterModel);\n        return vm.types;\n      });\n\n      function typeArrayToMap(prev, curr) {\n        prev[curr.id] = curr.name;\n        return prev;\n      }\n\n      function typeArrayToFilterModel(type) {\n        type.checked = false;\n        return type;\n      }\n    }\n\n    function getRecords() {\n      return MapData.getRecords()\n        .then(function(data) {\n          return data;\n        });\n    }\n\n    /////////////////////////////////\n    // Dialog setup\n    // /////////////////////////////\n    function setupControls() {\n      vm.showDialog = MapDialog.initMarkerDialog(\n        vm.types,\n        Gmap,\n        neatMap,\n        magicMarker\n      );\n\n      $scope.$watch('mp.filterSeverity', function(now) {\n        if (now && !clearing) {\n          vm.applySeverity = true;\n        }\n        clearing = false;\n      });\n    }\n\n    /////////////////////////////////\n    // Filter Menu\n    // /////////////////////////////\n    function toggleSideMenu() {\n      return $mdSidenav('left').toggle();\n    }\n\n    function filterUpdate() {\n      var chosenTypes = vm.filterTypes.reduce(toTypeIdArray, []);\n      // reset markers before update\n      clearMarkers();\n      // if nothing is chosen, do nothing\n      if (chosenTypes.length === 0 && !vm.applySeverity) {\n        return getRecords()\n          .then(assignRecordsToMarkers);\n      }\n      // selecting all types is the same as selecting none: return all\n      if (chosenTypes.length === vm.filterTypes.length) {\n        chosenTypes = [];\n      }\n      // severity 0 to prevent applying severity filter for MapData service\n      var fSeverity = vm.applySeverity ? vm.filterSeverity : 0;\n\n      return MapData.getFilteredRecords(chosenTypes, fSeverity)\n        .then(assignRecordsToMarkers);\n\n      function toTypeIdArray(types, curr) {\n        if (curr.checked) {\n          types.push(curr.id);\n        }\n        return types;\n      }\n    }\n\n    function filterClearAll() {\n      clearing = true;\n      vm.filterTypes.forEach(clearAllTypes);\n      vm.filterSeverity = 1;\n      vm.applySeverity = false;\n\n      function clearAllTypes(type) {\n        type.checked = false;\n      }\n      return;\n    }\n\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .controller('AuthController', AuthController);\n\n  /** @ngInject */\n  function AuthController(\n    $state,\n    $log,\n    AuthService\n  ) {\n    var vm = this;\n\n    vm.login = login;\n    vm.join = joinNeat;\n    vm.enter = enter;\n\n    // TODO: if form invalid, disable function\n    function login() {\n      AuthService.login(vm.email, vm.password)\n        .then(function() {\n          AuthService.getMe().then(function() {\n            $state.go('map');\n          });\n        });\n    }\n\n    function joinNeat() {\n      AuthService.register(\n        vm.email,\n        vm.name,\n        vm.password,\n        vm.confirm\n      ).then(function(res) {\n        if (res.user.active) {\n          login();\n        }\n      });\n    }\n\n    function enter(ev, join) {\n      if (ev.charCode !== 13) return;\n      if (join) {\n        return joinNeat();\n      }\n      return login();\n    }\n\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .controller('NavController', NavController);\n\n  /** @ngInject */\n  function NavController(\n    AuthService,\n    $state\n  ) {\n    var vm = this;\n\n    vm.logout = logout;\n\n    function logout() {\n      AuthService.logout();\n      $state.go('login');\n    }\n\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('AuthToken', AuthToken);\n\n  /** @ngInject */\n  function AuthToken(\n    $window\n  ) {\n\n    var service = {\n      getToken: getToken,\n      setToken: setToken\n    };\n\n    return service;\n\n    function getToken() {\n      return $window.localStorage.getItem('token');\n    }\n\n    function setToken(token) {\n      if (token) {\n        $window.localStorage.setItem('token', token);\n      } else {\n        $window.localStorage.removeItem('token');\n      }\n    }\n\n  } // AuthToken\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('AuthService', AuthService);\n\n  /** @ngInject */\n  function AuthService(\n    AuthToken,\n    $http,\n    $q,\n    $log,\n    $rootScope,\n    url\n  ) {\n\n    var service = {\n      register: register,\n      login: login,\n      logout: logout,\n      isLoggedIn: isLoggedIn,\n      isAdmin: isAdmin,\n      isSelf: isSelf,\n      getMe: getMe\n    };\n\n    return service;\n\n    function register(email, name, password, confirm) {\n      return $http.put(url('/register'), {\n        email: email,\n        name: name,\n        password: password,\n        confirm: confirm\n      }).then(registrationComplete)\n        .catch(registrationFailed);\n\n      function registrationComplete(data) {\n        return data.data;\n      }\n\n      function registrationFailed(e) {\n        $log.error(e.data);\n        return $q.reject(e);\n      }\n    }\n\n    function login(email, password) {\n      // make sure to clear user, useful for register\n      logout();\n\n      return $http.post(url('/authenticate'), {\n        email: email,\n        password: password\n      }).then(authSuccess)\n        .catch(authFailed);\n\n      function authSuccess(data) {\n        AuthToken.setToken(data.data.token);\n        return data.data;\n      }\n\n      function authFailed(e) {\n        AuthToken.setToken();\n        $log.error(e.data);\n        return $q.reject(e);\n      }\n    }\n\n    function logout() {\n      AuthToken.setToken();\n      $rootScope.me = {};\n    }\n\n    function isLoggedIn() {\n      return AuthToken.getToken() ? true : false;\n    }\n\n    function isAdmin() {\n      return Boolean($rootScope.me) && $rootScope.me.privilege == 'A';\n    }\n\n    function isSelf(id) {\n      return $rootScope.me && $rootScope.me.id == id;\n    }\n\n    function getMe() {\n      return $http.get(url('/me'))\n        .then(getMeComplete)\n        .catch(getMeFailed);\n\n      function getMeComplete(data) {\n        var me = data.data.user;\n        $rootScope.me = me;\n        $log.info('Added me');\n        return me;\n      }\n\n      function getMeFailed(e) {\n        $log.error(e.data);\n        return $q.reject(e);\n      }\n    }\n\n  } // AuthService\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .factory('AuthInterceptor', AuthInterceptor);\n\n  /** @ngInject */\n  function AuthInterceptor(\n    $q,\n    AuthToken\n  ) {\n\n    var service = {\n      request: request,\n      responseError: responseError\n    };\n\n    return service;\n\n    function request(config) {\n      var token = AuthToken.getToken();\n      if (token) {\n        config.headers.Authorization = 'Bearer ' + token;\n      }\n      return config;\n    }\n\n    function responseError(res) {\n      if (res.status == 403) {\n        AuthToken.setToken();\n      }\n      return $q.reject(res);\n    }\n\n  } // AuthInterceptor\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock(\n    $log,\n    $rootScope,\n    $state,\n    AuthService\n  ) {\n\n    $rootScope.$on('$stateChangeStart', watchAuth);\n\n    function watchAuth(e, toState) {\n      var isLoggedIn = AuthService.isLoggedIn();\n\n      if (toState.name === 'join') {\n        return;\n      }\n\n      if (toState.name === 'login') {\n        if (isLoggedIn) {\n          e.preventDefault();\n          $state.go('map');\n        }\n        return;\n      }\n\n      if (isLoggedIn) {\n        if (!$rootScope.me || !$rootScope.me.privilege) {\n          AuthService.getMe().then(function() {\n            $log.info('Readded me');\n          });\n        }\n      } else {\n        e.preventDefault();\n        $state.go('login');\n      }\n    }\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig(\n    $stateProvider,\n    $locationProvider,\n    $urlRouterProvider\n  ) {\n    var navView = {\n      templateUrl: 'app/layout/nav.html',\n      controller: 'NavController',\n      controllerAs: 'nv'\n    };\n\n    $stateProvider\n      .state('map', {\n        url: '/',\n        views: {\n          nav: navView,\n          content: {\n            templateUrl: 'app/map/map.html',\n            controller: 'MapController',\n            controllerAs: 'mp'\n          }\n        }\n      })\n      .state('users', {\n        url: '/users',\n        views: {\n          nav: navView,\n          content: {\n            templateUrl: 'app/users/users.html',\n            controller: 'UsersController',\n            controllerAs: 'us'\n          }\n        }\n      })\n      .state('join', {\n        url: '/join',\n        views: {\n          content: {\n            templateUrl: 'app/login/join.html',\n            controller: 'AuthController',\n            controllerAs: 'au'\n          }\n        }\n      })\n      .state('login', {\n        url: '/login',\n        views: {\n          content: {\n            templateUrl: 'app/login/login.html',\n            controller: 'AuthController',\n            controllerAs: 'au'\n          }\n        }\n      });\n\n    $urlRouterProvider.otherwise('/');\n    $locationProvider.html5Mode(true);\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .constant('ApiKey', 'AIzaSyC_I1rGTiTnBiYQmCFou6xYWzC1rR3QetM')\n    .constant('mapIcons', mapIcons)\n    .constant('byId', byId)\n    .constant('url', url);\n\n  function mapIcons(type, level, Gmap) {\n    type = type.toLowerCase();\n    var levels = {\n      1: '-green',\n      2: '-yellow',\n      3: '-yellow',\n      4: '-red',\n      5: '-red'\n    };\n    var url = '../assets/images/';\n    if (type == 'placeholder') {\n      url += type + '.svg';\n    } else {\n      url += type.replace(' ', '-') + levels[level] + '.svg';\n    }\n    return {\n      url: url,\n      anchor: new Gmap.Point(28, 28)\n    };\n  }\n\n  function byId(id) {\n    return document.getElementById(id);\n  }\n\n  function url(path, id) {\n    var baseUrl = 'http://neatmap.xyz/api';\n    path = baseUrl + path;\n    if (id) path += '/' + id;\n    return path;\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('neatClient')\n    .config(config);\n\n  /** @ngInject */\n  function config(\n    $logProvider,\n    $httpProvider,\n    $mdThemingProvider,\n    $mdIconProvider\n  ) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    $httpProvider.interceptors.push('AuthInterceptor');\n\n    // Custom themes\n    var neatGrey = $mdThemingProvider.extendPalette('blue-grey', {\n      '900': '#1f2532'\n    });\n    var neatRed = $mdThemingProvider.extendPalette('red', {\n      '400': '#ff5252'\n    });\n\n    $mdThemingProvider\n      .definePalette('neatGrey', neatGrey)\n      .definePalette('neatRed', neatRed)\n      .theme('default')\n      .primaryPalette('neatRed', {\n        'default': '400'\n      })\n      .accentPalette('neatGrey', {\n        'default': '900',\n        'hue-2': '500'\n      })\n      .warnPalette('orange');\n\n    // Register icons\n    $mdIconProvider\n      .icon('logo-header', '/assets/images/logo-header.svg')\n      .icon('logo-login', '/assets/images/logo-login.svg');\n  }\n\n})();\n\nangular.module(\"neatClient\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/layout/nav.html\",\"<md-toolbar layout=\\\"row\\\" class=\\\"md-accent md-whiteframe-4dp pos-fixed\\\"><md-button flex=\\\"20\\\" aria-label=\\\"App Logo, Go to Home\\\"><a ui-sref=\\\"map\\\"><md-icon md-svg-icon=\\\"logo-header\\\" class=\\\"head-logo\\\"></md-icon></a></md-button><nav flex=\\\"60\\\" layout=\\\"row\\\" layout-align=\\\"center center\\\"><a class=\\\"nav-link\\\" ui-sref=\\\"map\\\" ui-sref-active=\\\"nav-link--active\\\" md-ink-ripple=\\\"\\\">Map</a> <a class=\\\"nav-link\\\" ui-sref=\\\"users\\\" ui-sref-active=\\\"nav-link--active\\\" md-ink-ripple=\\\"\\\">Users</a></nav><span flex=\\\"20\\\" layout=\\\"row\\\" layout-align=\\\"center center\\\"><md-menu><md-button ng-click=\\\"$mdOpenMenu($event)\\\"><i class=\\\"material-icons mi--mid\\\">account_circle</i> {{me.name.split(\\' \\')[0]}}</md-button><md-menu-content><md-menu-item><p>{{me.name}}</p></md-menu-item><md-menu-item><md-button class=\\\"md-primary\\\" ng-click=\\\"nv.logout()\\\">Logout</md-button></md-menu-item></md-menu-content></md-menu></span></md-toolbar>\");\n$templateCache.put(\"app/login/join.html\",\"<md-content class=\\\"dark-bg\\\" layout=\\\"row\\\" layout-align=\\\"center center\\\" layout-fill=\\\"\\\"><md-card flex=\\\"30\\\" flex-md=\\\"40\\\" flex-sm=\\\"55\\\" flex-xs=\\\"90\\\" class=\\\"login-box md-whiteframe-6dp\\\"><div style=\\\"height:70px\\\"><md-icon md-svg-icon=\\\"logo-login\\\" class=\\\"join-logo\\\"></md-icon></div><form name=\\\"joinForm\\\" class=\\\"login-form\\\"><div layout=\\\"column\\\"><md-input-container><label>Email</label> <input name=\\\"email\\\" type=\\\"email\\\" required=\\\"\\\" ng-pattern=\\\"/^.+@.+\\\\..+$/\\\" ng-model=\\\"au.email\\\"><div ng-messages=\\\"joinForm.email.$error\\\"><div ng-message=\\\"required\\\">Email Required</div><div ng-message=\\\"pattern\\\">Invalid Email</div></div></md-input-container><md-input-container><label>Name</label> <input name=\\\"name\\\" ng-model=\\\"au.name\\\"></md-input-container><md-input-container><label>Password</label> <input type=\\\"password\\\" name=\\\"password\\\" required=\\\"\\\" ng-model=\\\"au.password\\\"><div ng-messages=\\\"joinForm.password.$error\\\"><div ng-message=\\\"required\\\">Password required</div></div></md-input-container><md-input-container><label>Confirm Password</label> <input type=\\\"password\\\" name=\\\"confirm\\\" ng-keypress=\\\"au.enter($event, true)\\\" required=\\\"\\\" ng-model=\\\"au.confirm\\\"><div ng-messages=\\\"joinForm.confirm.$error\\\"><div ng-message=\\\"required\\\">Confirm Password required</div></div></md-input-container></div></form><md-card-actions layout=\\\"column\\\"><md-button class=\\\"login-btn md-raised md-primary\\\" ng-click=\\\"au.join()\\\">Join Neat</md-button></md-card-actions></md-card></md-content>\");\n$templateCache.put(\"app/login/login.html\",\"<md-content class=\\\"dark-bg\\\" layout=\\\"row\\\" layout-align=\\\"center center\\\" layout-fill=\\\"\\\"><md-card flex=\\\"30\\\" flex-md=\\\"40\\\" flex-sm=\\\"55\\\" flex-xs=\\\"90\\\" class=\\\"login-box md-whiteframe-6dp\\\"><div style=\\\"height:140px\\\"><md-icon md-svg-icon=\\\"logo-login\\\" class=\\\"login-logo\\\"></md-icon></div><form name=\\\"loginForm\\\" class=\\\"login-form\\\"><div layout=\\\"column\\\"><md-input-container><label>Email</label> <input name=\\\"email\\\" type=\\\"email\\\" required=\\\"\\\" ng-pattern=\\\"/^.+@.+\\\\..+$/\\\" ng-model=\\\"au.email\\\"><div ng-messages=\\\"loginForm.email.$error\\\"><div ng-message=\\\"required\\\">Email Required</div><div ng-message=\\\"pattern\\\">Invalid Email</div></div></md-input-container><md-input-container><label>Password</label> <input type=\\\"password\\\" name=\\\"password\\\" ng-keypress=\\\"au.enter($event)\\\" required=\\\"\\\" ng-model=\\\"au.password\\\"><div ng-messages=\\\"loginForm.password.$error\\\"><div ng-message=\\\"required\\\">Password required</div></div></md-input-container></div></form><md-card-actions layout=\\\"column\\\"><md-button class=\\\"login-btn md-raised md-primary\\\" ng-click=\\\"au.login()\\\">Login</md-button></md-card-actions></md-card></md-content>\");\n$templateCache.put(\"app/map/map.html\",\"<md-sidenav class=\\\"md-sidenav-left\\\" md-component-id=\\\"left\\\" md-whiteframe=\\\"4\\\"><md-toolbar><h1 class=\\\"md-toolbar-tools\\\"><i class=\\\"material-icons mi--mid\\\" style=\\\"margin-right:10px\\\">blur_circular</i> Filter Records</h1></md-toolbar><div layout=\\\"column\\\" layout-padding=\\\"\\\" layout-margin=\\\"\\\"><h4 class=\\\"md-subhead\\\">Type</h4><div layout=\\\"row\\\" layout-wrap=\\\"\\\"><md-checkbox class=\\\"md-primary\\\" flex=\\\"45\\\" ng-repeat=\\\"type in mp.filterTypes\\\" ng-model=\\\"type.checked\\\" aria-label=\\\"{{type.name}} checkbox\\\">{{type.name}}</md-checkbox></div><md-checkbox class=\\\"md-primary\\\" style=\\\"margin-left:16px\\\" ng-model=\\\"mp.applySeverity\\\" aria-label=\\\"Apply severity filter checkbox\\\">Severity: {{mp.applySeverity ? mp.filterSeverity : \\'n/a\\'}}</md-checkbox><md-slider class=\\\"md-primary\\\" ng-model=\\\"mp.filterSeverity\\\" step=\\\"1\\\" min=\\\"1\\\" max=\\\"5\\\" aria-label=\\\"severity filter slider\\\" md-discrete=\\\"\\\"></md-slider><div layout=\\\"row\\\" layout-wrap=\\\"\\\"><md-button class=\\\"md-primary\\\" ng-click=\\\"mp.filterClearAll()\\\">Clear All</md-button><md-button class=\\\"md-raised md-primary\\\" ng-click=\\\"mp.filterUpdate()\\\">Update</md-button><md-button ng-click=\\\"mp.toggleSideMenu()\\\">Cancel</md-button></div></div></md-sidenav><md-button class=\\\"md-fab md-fab--lg md-fab--search pos-fixed\\\" ng-click=\\\"mp.toggleSideMenu()\\\" aria-label=\\\"Filter markers\\\"><i class=\\\"material-icons mi--mid\\\">assignment</i></md-button><md-button class=\\\"md-fab md-primary md-fab--lg md-fab--add pos-fixed\\\" ng-click=\\\"mp.showDialog($event)\\\" aria-label=\\\"Add user\\\"><i class=\\\"material-icons mi--mid\\\">add_location</i></md-button><div layout=\\\"row\\\" id=\\\"map\\\" layout-fill=\\\"\\\"></div>\");\n$templateCache.put(\"app/map/marker.dialog.html\",\"<md-dialog aria-label=\\\"Add Marker\\\" flex=\\\"30\\\" flex-md=\\\"40\\\" flex-sm=\\\"55\\\" flex-xs=\\\"90\\\" layout-padding=\\\"\\\"><md-dialog-content><div class=\\\"md-dialog-content\\\"><h3 class=\\\"md-headline\\\">Add Marker</h3><form name=\\\"markerForm\\\"><div layout=\\\"column\\\"><div layout=\\\"row\\\" layout-align=\\\"center center\\\"><md-input-container md-no-float=\\\"\\\" flex=\\\"90\\\"><input name=\\\"address\\\" id=\\\"address\\\" type=\\\"text\\\" placeholder=\\\"Location\\\" ng-model=\\\"address\\\"></md-input-container><span ng-if=\\\"locating\\\" flex=\\\"10\\\"><md-progress-circular md-mode=\\\"indeterminate\\\" md-diameter=\\\"20\\\"></md-progress-circular></span> <span ng-if=\\\"!locating\\\" flex=\\\"10\\\"><md-button class=\\\"md-icon-button md-primary\\\" ng-click=\\\"locateCurrent()\\\" aria-label=\\\"current location\\\"><i class=\\\"material-icons\\\">my_location</i></md-button></span></div><md-input-container><label>Type</label><md-select ng-model=\\\"typeId\\\"><md-option ng-repeat=\\\"(key, type) in types\\\" value=\\\"{{key}}\\\">{{type}}</md-option></md-select></md-input-container><md-input-container><label>Description</label> <textarea ng-model=\\\"description\\\" md-maxlength=\\\"240\\\" row=\\\"3\\\"></textarea></md-input-container><h4 class=\\\"md-subhead\\\">Severity</h4><md-slider class=\\\"md-primary\\\" ng-model=\\\"severity\\\" step=\\\"1\\\" min=\\\"1\\\" max=\\\"5\\\" aria-label=\\\"severity\\\" md-discrete=\\\"\\\"></md-slider></div></form></div></md-dialog-content><md-dialog-actions><md-button ng-click=\\\"cancel()\\\" class=\\\"md-primary\\\">Cancel</md-button><md-button ng-click=\\\"confirm()\\\" class=\\\"md-primary\\\">Save</md-button></md-dialog-actions></md-dialog>\");\n$templateCache.put(\"app/users/add.dialog.html\",\"<md-dialog aria-label=\\\"Add User\\\" flex=\\\"30\\\" flex-md=\\\"40\\\" flex-sm=\\\"55\\\" flex-xs=\\\"90\\\" layout-padding=\\\"\\\"><md-dialog-content><div class=\\\"md-dialog-content\\\"><h3 class=\\\"md-headline\\\">Add User</h3><form name=\\\"userForm\\\"><div layout=\\\"column\\\"><md-input-container class=\\\"user-form-input\\\"><label>Email</label> <input type=\\\"email\\\" name=\\\"email\\\" required=\\\"\\\" ng-pattern=\\\"/^.+@.+\\\\..+$/\\\" ng-model=\\\"email\\\"><div ng-messages=\\\"userForm.email.$error\\\"><div ng-message=\\\"required\\\">Email Required</div><div ng-message=\\\"pattern\\\">Invalid Email</div></div></md-input-container><md-input-container class=\\\"user-form-input\\\"><label>Name</label> <input ng-model=\\\"name\\\"></md-input-container><h4 class=\\\"md-subhead\\\">User Role</h4><md-radio-group ng-model=\\\"privilege\\\"><md-radio-button value=\\\"M\\\" class=\\\"md-primary btn-role\\\">Member</md-radio-button><md-radio-button value=\\\"A\\\" class=\\\"md-primary btn-role\\\">Admin</md-radio-button></md-radio-group></div></form></div></md-dialog-content><md-dialog-actions><md-button ng-click=\\\"cancel()\\\" class=\\\"md-primary\\\">Cancel</md-button><md-button ng-click=\\\"add()\\\" class=\\\"md-primary\\\">Save</md-button></md-dialog-actions></md-dialog>\");\n$templateCache.put(\"app/users/users.html\",\"<div class=\\\"light-bg nav-padding\\\" layout=\\\"column\\\" layout-fill=\\\"\\\"><div layout=\\\"row\\\" layout-align=\\\"center start\\\"><md-content class=\\\"light-bg user-content\\\" flex=\\\"50\\\" flex-lg=\\\"60\\\" flex-md=\\\"70\\\" flex-sm=\\\"90\\\" flex-xs=\\\"100\\\"><md-subheader class=\\\"user-subheader\\\"><md-menu><md-button class=\\\"md-btn--shrink\\\" ng-disabled=\\\"!us.isAdmin()\\\" ng-click=\\\"$mdOpenMenu($event)\\\">{{ us.showEnabled ? \\'Enabled Users\\' : \\'Disabled Users\\' }} <i class=\\\"material-icons mi--mid\\\">expand_more</i></md-button><md-menu-content><md-menu-item><md-button ng-disabled=\\\"true\\\">{{ us.showEnabled ? \\'Enabled Users\\' : \\'Disabled Users\\' }}</md-button></md-menu-item><md-menu-item><md-button ng-click=\\\"us.switchUsers()\\\">{{ !us.showEnabled ? \\'Enabled Users\\' : \\'Disabled Users\\' }}</md-button></md-menu-item></md-menu-content></md-menu><md-input-container class=\\\"user-search\\\" md-no-float=\\\"\\\"><input id=\\\"user-search\\\" type=\\\"text\\\" ng-model=\\\"us.search\\\" placeholder=\\\"Search\\\"></md-input-container></md-subheader><md-list><md-list-item class=\\\"md-2-line\\\" ng-repeat=\\\"user in us.users | filter:us.search\\\" ng-click=\\\"null\\\"><div class=\\\"md-list-item-text\\\" layout=\\\"column\\\"><h3>{{ user.name }}</h3><p>{{ user.email }}</p></div><md-menu class=\\\"md-secondary\\\" hide-md=\\\"\\\" hide-sm=\\\"\\\" hide-xs=\\\"\\\"><md-button ng-class=\\\"us.roleClass(user.privilege)\\\" ng-disabled=\\\"user.disabled || us.isSelf(user.id) || !us.isAdmin()\\\" ng-click=\\\"$mdOpenMenu($event)\\\">{{ user.privilege == \\'A\\' ? \\'Admin\\' : \\'Member\\' }} <i class=\\\"material-icons mi--mid\\\">arrow_drop_down</i></md-button><md-menu-content><md-menu-item><md-button ng-disabled=\\\"true\\\">{{ user.privilege == \\'A\\' ? \\'Admin\\' : \\'Member\\' }}</md-button></md-menu-item><md-menu-item><md-button ng-click=\\\"us.changeRole(user)\\\">{{ user.privilege != \\'A\\' ? \\'Admin\\' : \\'Member\\' }}</md-button></md-menu-item></md-menu-content></md-menu><md-button class=\\\"md-secondary md-primary\\\" ng-if=\\\"us.isAdmin()\\\" ng-disabled=\\\"us.isSelf(user.id) || !user.disabled && !user.active\\\" ng-click=\\\"us.showConfirm($event,$index,us.resetText(user),user,us.users)\\\" hide-xs=\\\"\\\">{{ us.resetText(user) }}</md-button><md-button class=\\\"md-secondary md-accent md-hue-1\\\" ng-disabled=\\\"us.isSelf(user.id) || !us.isAdmin()\\\" ng-click=\\\"us.showConfirm($event,$index,\\'del\\',user,us.users)\\\" aria-label=\\\"Delete user\\\"><i class=\\\"material-icons mi--mid\\\">{{ user.disabled ? \\'delete_forever\\' : \\'delete\\' }}</i></md-button><md-divider></md-divider></md-list-item></md-list></md-content></div><md-button class=\\\"md-fab md-fab--lg md-fab--search pos-fixed\\\" ng-click=\\\"us.focusSearch()\\\" aria-label=\\\"Search user\\\"><i class=\\\"material-icons mi--mid\\\">search</i></md-button><md-button class=\\\"md-fab md-primary md-fab--lg md-fab--add pos-fixed\\\" ng-if=\\\"us.isAdmin()\\\" ng-click=\\\"us.addOrDeleteAll($event)\\\" aria-label=\\\"Add user\\\"><i class=\\\"material-icons mi--mid\\\">{{ us.showEnabled ? \\'add\\' : \\'delete_sweep\\' }}</i></md-button></div>\");}]);"],"sourceRoot":"/source/"}