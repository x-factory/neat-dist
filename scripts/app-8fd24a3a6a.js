!function(){"use strict";angular.module("neatClient",["ngAnimate","ngCookies","ngSanitize","ngMessages","ngAria","ui.router","ngMaterial"])}(),function(){"use strict";function e(e,t,n,a,r){function i(){function e(){b=$.getElementById("user-search")}return angular.element($).ready(e),y.showEnabled=!0,o().then(d)}function o(){return e.getUsers().then(l(h))}function l(e){return function(t){return e=t,y.users=e,y.users}}function d(){var e=y.showEnabled?" ":" disabled ";t.info("Loaded"+e+"users")}function s(){return e.getDisabledUsers().then(l(v))}function c(){return y.showEnabled=!y.showEnabled,y.showEnabled?o().then(d):s().then(d)}function u(e){y.showEnabled?w(e,y.users):y.showConfirm(e,0,"delAll",{name:""},y.users)}function m(t){var n="A"==t.privilege?"M":"A";e.updateRole(t.id,n).then(function(){t.privilege=n})}function g(){b.focus()}function f(e){return"A"==e?"md-warn":"md-accent md-hue-3"}function p(e){return e.disabled?"enable":e.active?"reset":"inactive"}var h,v,b,y=this,$=n[0],w=r.showAdd;y.isAdmin=a.isAdmin,y.isSelf=a.isSelf,y.switchUsers=c,y.showConfirm=r.showConfirm,y.addOrDeleteAll=u,y.changeRole=m,y.focusSearch=g,y.roleClass=f,y.resetText=p,i()}e.$inject=["UserData","$log","$document","AuthService","UserDialog"],angular.module("neatClient").controller("UsersController",e)}(),function(){"use strict";function e(e,t,n,a){function r(n,a,r,o,l){function d(){return"Confirm to"+s[r].text+o.name}var s={del:{text:" delete ",content:"If the user has associated records, user will be disabled instead. Switch to disabled users view to perform hard delete.",ariaLabel:"Confirm delete",ok:"Delete",confirmAction:function(){t.deleteUser(o.id).then(function(e){l.splice(a,1),i(e.message+": "+o.name)})}},delAll:{text:" DELETE ALL ",content:"Delete all disabled users. Are you sure?",ariaLabel:"Confirm delete all",ok:"Delete All",confirmAction:function(){t.deleteAllDisabled().then(function(e){l.length=0,i(e.message+": "+e.affected)})}},reset:{text:" reset ",content:"Deactivate user and reset password. Once reset, user need to go through sign up process same as new user",ariaLabel:"Confirm reset",ok:"Reset",confirmAction:function(){t.resetUser(o.id).then(function(){o.active=!1,i("Reset "+o.name)})}},enable:{text:" enable ",content:"Will restore user to original state (active or inactive)",ariaLabel:"Confirm enable",ok:"Enable",confirmAction:function(){t.enableUser(o.id).then(function(){l.splice(a,1),i("Enabled "+o.name)})}}},c=e.confirm().title(d()).textContent(s[r].content).ariaLabel(s[r].ariaLabel).targetEvent(n).ok(s[r].ok).cancel("Cancel");e.show(c).then(s[r].confirmAction)}function i(e){return a.show(a.simple().textContent(e).position("bottom right").hideDelay(2e3))}function o(n,a){function r(e,n){e.privilege="M",e.cancel=function(){n.cancel()},e.add=function(){t.createUser({email:e.email,name:e.name,privilege:e.privilege}).then(function(e){var t=e.user;a.push(t),i("Added user: "+t.name),n.hide()})}}r.$inject=["$scope","$mdDialog"],e.show({controller:r,templateUrl:"app/users/add.dialog.html",parent:angular.element(l.body),targetEvent:n,clickOutsideToClose:!0})}var l=n[0],d={showConfirm:r,showAdd:o};return d}e.$inject=["$mdDialog","UserData","$document","$mdToast"],angular.module("neatClient").factory("UserDialog",e)}(),function(){"use strict";function e(e,t,n,a){function r(){return a.get(e("/users")).then(o)["catch"](d("XHR getUsers failed"))}function i(){return a.get(e("/users?disabled=1")).then(o)["catch"](d("XHR getDisabledUsers failed"))}function o(e){var t=e.data.users;return t}function l(e){return e.data}function d(e){return function(a){var r=e;return a.data&&a.data.description&&(r+="\n"+a.data.description),a.data&&(a.data.description=r),n.error(a.data),t.reject(a)}}function s(t){return a.post(e("/users"),t).then(l)["catch"](d("XHR createUser failed"))}function c(t){return a.put(e("/user",t),{password:"null",active:"No"}).then(l)["catch"](d(p("resetUser",t)))}function u(t,n){return a.put(e("/user",t),{privilege:n}).then(l)["catch"](d(p("updateRole",t)))}function m(t){return a.put(e("/user",t),{disabled:"false"}).then(l)["catch"](d(p("enableUser",t)))}function g(t){return a["delete"](e("/user",t)).then(l)["catch"](d(p("deleteUser",t)))}function f(){return a["delete"](e("/users")).then(l)["catch"](d("XHR deleteAllDisabled failed"))}function p(e,t){return"XHR "+e+" by "+t+" failed"}var h={getUsers:r,getDisabledUsers:i,createUser:s,resetUser:c,updateRole:u,enableUser:m,deleteUser:g,deleteAllDisabled:f};return h}e.$inject=["url","$q","$log","$http"],angular.module("neatClient").factory("UserData",e)}(),function(){"use strict";function e(e,t,n,a){function r(e,t){n.log("adding script tag");var a=i.createElement("script");a.src=e+t,i.body.appendChild(a)}var i=e.document,o="https://maps.googleapis.com/maps/api/js?key=";o+=t+"&libraries=places&callback=";var l=a.defer();e.GMapInitialized=l.resolve,r(o,"GMapInitialized");var d={initialized:l.promise};return d}e.$inject=["$window","ApiKey","$log","$q"],angular.module("neatClient").factory("MapInit",e)}(),function(){"use strict";function e(e,t,n,a,r,i,o,l,d,s){function c(e){var t="<h4>"+e.Location.address+"</h4>",n="<p>Severity: "+e.severity+"</p>",a="<p>"+e.description+"</p>",r="<md-divider></md-divider>",i='<button class="md-primary md-button" type="button" aria-label="Edit" id="edit-record-btn">Edit</button>',o='<button class="md-primary md-button" type="button" aria-label="Delete" id="del-record-btn">Delete</button>',l=t+n+a+r+i+o;return l}function u(o,c,u,m){return function(f,p,h){function v(a,i){function f(){var t=e("address"),n=new c.places.SearchBox(t);u.addListener("bounds_changed",function(){n.setBounds(u.getBounds())}),n.addListener("places_changed",function(){var e=n.getPlaces();if(0!==e.length){var t=e[0];k.address=t.name,k["long"]=t.geometry.location.lng(),k.lat=t.geometry.location.lat()}})}function v(){i.cancel()}function b(){var e={"long":k["long"],lat:k.lat,address:k.address,description:k.description,severity:k.severity,user_id:l.user.id,type_id:k.typeId};C?$(e):y(e),i.hide()}function y(e){t.createRecord(e).then(function(e){var t=e.record;t.Location={address:k.address,latitude:k.lat,longitude:k["long"]},m(k.lat,k["long"],t,!0)})}function $(e){t.updateRecord(A.id,e).then(function(e){h.close();var t=e.affected[1][0];t.Location={address:k.address,latitude:k.lat,longitude:k["long"]},p.myRecord=t,p.setIcon(n(o[t.TypeId],t.severity,c)),p.setPosition({lat:k.lat,lng:k["long"]})})}function w(){k.address="Locating...",k.locating=!0,g.geolocation?g.geolocation.getCurrentPosition(function(e){k.lat=e.coords.latitude,k["long"]=e.coords.longitude;var t=new c.Geocoder;t.geocode({location:{lat:k.lat,lng:k["long"]}},function(e,t){k.locating=!1,t===c.GeocoderStatus.OK?e[1]?(k.address=e[1].formatted_address,k.$apply()):s.alert("No results found"):s.alert("Geocoder failed due to: "+t)})}):r.error("Browser does not support goelocation")}var A,k=a,C=p?!0:!1;d(f),k.types=o,k.severity=3,k.cancel=v,k.confirm=b,k.locateCurrent=w,C&&(A=p.myRecord,k.lat=A.Location.latitude,k["long"]=A.Location.longitude,k.address=A.Location.address,k.description=A.description,k.severity=A.severity,k.typeId=A.TypeId)}v.$inject=["$scope","$mdDialog"],i.show({controller:v,templateUrl:"app/map/marker.dialog.html",parent:angular.element(a[0].body),targetEvent:f,clickOutsideToClose:!0})}}function m(e,n,a){function o(){t.deleteRecord(n.myRecord.id).then(l)}function l(e){n.setMap(null),a.splice(a.indexOf(n),1),r.info(e)}var d=n.myRecord,s=d.Location.address,c="Inreversible. Are you sure you want to delete: "+s+"?",u=i.confirm().title("Confirm to delete").textContent(c).ariaLabel("Confirm delete").targetEvent(e).ok("Delete").cancel("Cancel");i.show(u).then(o)}var g=s.navigator,f={createInfoContent:c,initMarkerDialog:u,confirmDelete:m};return f}e.$inject=["byId","MapData","mapIcons","$document","$log","$mdDialog","$mdToast","$rootScope","$timeout","$window"],angular.module("neatClient").factory("MapDialog",e)}(),function(){"use strict";function e(e,t,n,a){function r(){return a.get(e("/types")).then(o("types"))["catch"](d("XHR getTypes failed"))}function i(){return a.get(e("/records")).then(o("records"))["catch"](d("XHR getRecords failed"))}function o(e){return function(t){return t.data[e]}}function l(e){return e.data}function d(e){return function(a){var r=e;return a.data&&a.data.description&&(r+="\n"+a.data.description),a.data&&(a.data.description=r),n.error(a.data),t.reject(a)}}function s(t){return a.post(e("/records"),t).then(l)["catch"](d("XHR createRecord failed"))}function c(t,n){return a.put(e("/record",t),n).then(l)["catch"](d(m("updateRecord",t)))}function u(t){return a["delete"](e("/record",t)).then(l)["catch"](d(m("deleteRecord",t)))}function m(e,t){return"XHR "+e+" by "+t+" failed"}var g={getTypes:r,getRecords:i,createRecord:s,updateRecord:c,deleteRecord:u};return g}e.$inject=["url","$q","$log","$http"],angular.module("neatClient").factory("MapData",e)}(),function(){"use strict";function e(e,t,n,a,r,i,o){function l(){v=e("map"),r.initialized.then(d).then(f)}function d(){return p=o.google.maps,h=new p.Map(v,{center:{lat:44.4120908,lng:-79.6701331},zoom:15}),m().then(g).then(s)}function s(e){return e.forEach(function(e){var t=e.Location;c(t.latitude,t.longitude,e)}),e}function c(e,t,n,r){var i={position:{lat:e,lng:t},icon:a(b.types[n.TypeId],n.severity,p),map:h,myRecord:n};r&&(i.animation=p.Animation.DROP);var o=new p.Marker(i);return u(o),y.push(o),o}function u(t){t.addListener("click",function(){var t=this,a=new p.InfoWindow({content:n.createInfoContent(t.myRecord)});a.addListener("domready",function(){var r=e("edit-record-btn"),i=e("del-record-btn");r.addEventListener("click",function(e){b.showDialog(e,t,a)}),i.addEventListener("click",function(e){n.confirmDelete(e,t,y)})}),a.open(h,t)})}function m(){function e(e,t){return e[t.id]=t.name.replace(" ","-"),e}return t.getTypes().then(function(t){return b.types=t.reduce(e,{}),b.types})}function g(){return t.getRecords().then(function(e){return e})}function f(){b.showDialog=n.initMarkerDialog(b.types,p,h,c)}var p,h,v,b=this,y=[];l()}e.$inject=["byId","MapData","MapDialog","mapIcons","MapInit","$mdDialog","$window"],angular.module("neatClient").controller("MapController",e)}(),function(){"use strict";function e(e,t,n){function a(){n.login(i.email,i.password).then(function(){n.getMe().then(function(){e.go("map")})})}function r(e){return 13===e.charCode?a():void 0}var i=this;i.login=a,i.enter=r}e.$inject=["$state","$log","AuthService"],angular.module("neatClient").controller("LoginController",e)}(),function(){"use strict";function e(e,t){function n(){}function a(){t.logout(),e.go("login")}var r=this;r.logout=a,n()}e.$inject=["$state","AuthService"],angular.module("neatClient").controller("NavController",e)}(),function(){"use strict";function e(e){function t(){return e.localStorage.getItem("token")}function n(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")}var a={getToken:t,setToken:n};return a}e.$inject=["$window"],angular.module("neatClient").factory("AuthToken",e)}(),function(){"use strict";function e(e,t,n,a,r,i){function o(r,o){function l(t){return e.setToken(t.data.token),t.data}function d(t){return e.setToken(),a.error(t.data),n.reject(t)}return t.post(i("/authenticate"),{email:r,password:o}).then(l)["catch"](d)}function l(){e.setToken(),r.user={}}function d(){return e.getToken()?!0:!1}function s(){return Boolean(r.user)&&"A"==r.user.privilege}function c(e){return r.user&&r.user.id==e}function u(){function e(e){var t=e.data.user;return r.user=t,a.info("Added me"),t}function o(e){return a.error(e.data),n.reject(e)}return t.get(i("/me")).then(e)["catch"](o)}var m={login:o,logout:l,isLoggedIn:d,isAdmin:s,isSelf:c,getMe:u};return m}e.$inject=["AuthToken","$http","$q","$log","$rootScope","url"],angular.module("neatClient").factory("AuthService",e)}(),function(){"use strict";function e(e,t){function n(e){var n=t.getToken();return n&&(e.headers.Authorization="Bearer "+n),e}function a(n){return 403==n.status&&t.setToken(),e.reject(n)}var r={request:n,responseError:a};return r}e.$inject=["$q","AuthToken"],angular.module("neatClient").factory("AuthInterceptor",e)}(),function(){"use strict";function e(e,t,n,a){function r(r,i){"login"!==i.name&&(a.isLoggedIn()?t.user&&t.user.privilege||a.getMe().then(function(){e.info("Readded me")}):(r.preventDefault(),n.go("login")))}t.$on("$stateChangeStart",r),e.debug("runBlock end")}e.$inject=["$log","$rootScope","$state","AuthService"],angular.module("neatClient").run(e)}(),function(){"use strict";function e(e,t,n){var a={templateUrl:"app/layout/nav.html",controller:"NavController",controllerAs:"nv"};e.state("map",{url:"/",views:{nav:a,content:{templateUrl:"app/map/map.html",controller:"MapController",controllerAs:"mp"}}}).state("users",{url:"/users",views:{nav:a,content:{templateUrl:"app/users/users.html",controller:"UsersController",controllerAs:"us"}}}).state("login",{url:"/login",views:{content:{templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"lg"}}}),n.otherwise("/"),t.html5Mode(!0)}e.$inject=["$stateProvider","$locationProvider","$urlRouterProvider"],angular.module("neatClient").config(e)}(),function(){"use strict";function e(e,t,n){e=e.toLowerCase();var a={1:"-green",2:"-yellow",3:"-yellow",4:"-red",5:"-red"},r="../assets/images/"+e+a[t]+".svg";return{url:r,anchor:new n.Point(28,28)}}function t(e){return document.getElementById(e)}function n(e,t){var n="http://neatmap.xyz/api";return e=n+e,t&&(e+="/"+t),e}angular.module("neatClient").constant("ApiKey","AIzaSyC_I1rGTiTnBiYQmCFou6xYWzC1rR3QetM").constant("mapIcons",e).constant("byId",t).constant("url",n)}(),function(){"use strict";function e(e,t,n,a){e.debugEnabled(!0),t.interceptors.push("AuthInterceptor");var r=n.extendPalette("blue-grey",{900:"#1f2532"}),i=n.extendPalette("red",{400:"#ff5252"});n.definePalette("neatGrey",r).definePalette("neatRed",i).theme("default").primaryPalette("neatRed",{"default":"400"}).accentPalette("neatGrey",{"default":"900","hue-2":"500"}).warnPalette("orange"),a.icon("logo-header","/assets/images/logo-header.svg").icon("logo-login","/assets/images/logo-login.svg")}e.$inject=["$logProvider","$httpProvider","$mdThemingProvider","$mdIconProvider"],angular.module("neatClient").config(e)}(),angular.module("neatClient").run(["$templateCache",function(e){e.put("app/layout/nav.html",'<md-toolbar layout="row" class="md-accent md-whiteframe-4dp pos-fixed"><md-button flex="20" aria-label="App Logo, Go to Home"><a ui-sref="map"><md-icon md-svg-icon="logo-header" class="head-logo"></md-icon></a></md-button><nav flex="60" layout="row" layout-align="center center"><a class="nav-link" ui-sref="map" ui-sref-active="nav-link--active" md-ink-ripple="">Map</a> <a class="nav-link" ui-sref="users" ui-sref-active="nav-link--active" md-ink-ripple="">Users</a></nav><span flex="20" layout="row" layout-align="center center"><md-button class="btn-logout" ng-click="nv.logout()">Logout</md-button></span></md-toolbar>'),e.put("app/login/login.html",'<md-content class="dark-bg" layout="row" layout-align="center center" layout-fill=""><md-card flex="30" flex-md="40" flex-sm="55" flex-xs="90" class="login-box md-whiteframe-6dp"><div style="height:140px"><md-icon md-svg-icon="logo-login" class="login-logo"></md-icon></div><form name="loginForm" class="login-form"><div layout="column"><md-input-container><label>Email</label> <input name="email" type="email" required="" ng-pattern="/^.+@.+\\..+$/" ng-model="lg.email"><div ng-messages="loginForm.email.$error"><div ng-message="required">Email Required</div><div ng-message="pattern">Invalid Email</div></div></md-input-container><md-input-container><label>Password</label> <input type="password" name="password" ng-keypress="lg.enter($event)" required="" ng-model="lg.password"><div ng-messages="loginForm.password.$error"><div ng-message="required">Password required</div></div></md-input-container></div></form><md-card-actions layout="column"><md-button class="login-btn md-raised md-primary" ng-click="lg.login()">Login</md-button></md-card-actions></md-card></md-content>'),e.put("app/map/map.html",'<md-button class="md-fab md-primary md-fab--lg md-fab--add pos-fixed" ng-click="mp.showDialog($event)" aria-label="Add user"><i class="material-icons mi--mid">add_location</i></md-button><div layout="row" id="map" layout-fill=""></div>'),e.put("app/map/marker.dialog.html",'<md-dialog aria-label="Add Marker" flex="30" flex-md="40" flex-sm="55" flex-xs="90" layout-padding=""><md-dialog-content><div class="md-dialog-content"><h3 class="md-headline">Add Marker</h3><form name="markerForm"><div layout="column"><div layout="row" layout-align="center center"><md-input-container md-no-float="" flex="90"><input name="address" id="address" type="text" placeholder="Location" ng-model="address"></md-input-container><span ng-if="locating" flex="10"><md-progress-circular md-mode="indeterminate" md-diameter="20"></md-progress-circular></span> <span ng-if="!locating" flex="10"><md-button class="md-icon-button md-primary" ng-click="locateCurrent()" aria-label="current location"><i class="material-icons">my_location</i></md-button></span></div><md-input-container><label>Type</label><md-select ng-model="typeId"><md-option ng-repeat="(key, type) in types" value="{{key}}">{{type}}</md-option></md-select></md-input-container><md-input-container><label>Description</label> <textarea ng-model="description" md-maxlength="240" row="3"></textarea></md-input-container><h4 class="md-subhead">Severity</h4><md-slider class="md-primary" ng-model="severity" step="1" min="1" max="5" aria-label="severity" md-discrete=""></md-slider></div></form></div></md-dialog-content><md-dialog-actions><md-button ng-click="cancel()" class="md-primary">Cancel</md-button><md-button ng-click="confirm()" class="md-primary">Save</md-button></md-dialog-actions></md-dialog>'),e.put("app/users/add.dialog.html",'<md-dialog aria-label="Add User" flex="30" flex-md="40" flex-sm="55" flex-xs="90" layout-padding=""><md-dialog-content><div class="md-dialog-content"><h3 class="md-headline">Add User</h3><form name="userForm"><div layout="column"><md-input-container class="user-form-input"><label>Email</label> <input type="email" name="email" required="" ng-pattern="/^.+@.+\\..+$/" ng-model="email"><div ng-messages="userForm.email.$error"><div ng-message="required">Email Required</div><div ng-message="pattern">Invalid Email</div></div></md-input-container><md-input-container class="user-form-input"><label>Name</label> <input ng-model="name"></md-input-container><h4 class="md-subhead">User Role</h4><md-radio-group ng-model="privilege"><md-radio-button value="M" class="md-primary btn-role">Member</md-radio-button><md-radio-button value="A" class="md-primary btn-role">Admin</md-radio-button></md-radio-group></div></form></div></md-dialog-content><md-dialog-actions><md-button ng-click="cancel()" class="md-primary">Cancel</md-button><md-button ng-click="add()" class="md-primary">Save</md-button></md-dialog-actions></md-dialog>'),e.put("app/users/users.html",'<div class="light-bg nav-padding" layout="column" layout-fill=""><div layout="row" layout-align="center start"><md-content class="light-bg user-content" flex="50" flex-lg="60" flex-md="70" flex-sm="90" flex-xs="100"><md-subheader class="user-subheader"><md-menu><md-button class="md-btn--shrink" ng-disabled="!us.isAdmin()" ng-click="$mdOpenMenu($event)">{{ us.showEnabled ? \'Enabled Users\' : \'Disabled Users\' }} <i class="material-icons mi--mid">expand_more</i></md-button><md-menu-content><md-menu-item><md-button ng-disabled="true">{{ us.showEnabled ? \'Enabled Users\' : \'Disabled Users\' }}</md-button></md-menu-item><md-menu-item><md-button ng-click="us.switchUsers()">{{ !us.showEnabled ? \'Enabled Users\' : \'Disabled Users\' }}</md-button></md-menu-item></md-menu-content></md-menu><md-input-container class="user-search" md-no-float=""><input id="user-search" type="text" ng-model="us.search" placeholder="Search"></md-input-container></md-subheader><md-list><md-list-item class="md-2-line" ng-repeat="user in us.users | filter:us.search" ng-click="null"><div class="md-list-item-text" layout="column"><h3>{{ user.name }}</h3><p>{{ user.email }}</p></div><md-menu class="md-secondary" hide-md="" hide-sm="" hide-xs=""><md-button ng-class="us.roleClass(user.privilege)" ng-disabled="user.disabled || us.isSelf(user.id) || !us.isAdmin()" ng-click="$mdOpenMenu($event)">{{ user.privilege == \'A\' ? \'Admin\' : \'Member\' }} <i class="material-icons mi--mid">arrow_drop_down</i></md-button><md-menu-content><md-menu-item><md-button ng-disabled="true">{{ user.privilege == \'A\' ? \'Admin\' : \'Member\' }}</md-button></md-menu-item><md-menu-item><md-button ng-click="us.changeRole(user)">{{ user.privilege != \'A\' ? \'Admin\' : \'Member\' }}</md-button></md-menu-item></md-menu-content></md-menu><md-button class="md-secondary md-primary" ng-if="us.isAdmin()" ng-disabled="us.isSelf(user.id) || !user.disabled && !user.active" ng-click="us.showConfirm($event,$index,us.resetText(user),user,us.users)" hide-xs="">{{ us.resetText(user) }}</md-button><md-button class="md-secondary md-accent md-hue-1" ng-disabled="us.isSelf(user.id) || !us.isAdmin()" ng-click="us.showConfirm($event,$index,\'del\',user,us.users)" aria-label="Delete user"><i class="material-icons mi--mid">{{ user.disabled ? \'delete_forever\' : \'delete\' }}</i></md-button><md-divider></md-divider></md-list-item></md-list></md-content></div><md-button class="md-fab md-fab--lg md-fab--search pos-fixed" ng-click="us.focusSearch()" aria-label="Search user"><i class="material-icons mi--mid">search</i></md-button><md-button class="md-fab md-primary md-fab--lg md-fab--add pos-fixed" ng-if="us.isAdmin()" ng-click="us.addOrDeleteAll($event)" aria-label="Add user"><i class="material-icons mi--mid">{{ us.showEnabled ? \'add\' : \'delete_sweep\' }}</i></md-button></div>')}]);
//# sourceMappingURL=../maps/scripts/app-8fd24a3a6a.js.map
